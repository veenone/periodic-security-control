<%= title l(:label_psc_control_points) %>

<div class="contextual">
  <%= link_to l(:label_psc_control_point_new), new_project_psc_control_point_path(@project), class: 'psc-btn psc-btn-primary' %>
</div>

<div class="psc-section">
  <%= form_tag(project_psc_control_points_path(@project), method: :get, class: 'psc-filter-form') do %>
    <div class="psc-filter-row">
      <div class="psc-filter-group">
        <label><%= l(:label_psc_category) %></label>
        <%= select_tag :category_id, options_for_select([['', '']] + @categories.map { |c| ["#{c.code} - #{c.name}", c.id] }, @category_filter) %>
      </div>

      <div class="psc-filter-group">
        <label><%= l(:field_frequency) %></label>
        <%= select_tag :frequency, options_for_select([['', '']] + PscControlPoint::FREQUENCIES.map { |k, v| [v[:label], k] }, @frequency_filter) %>
      </div>

      <div class="psc-filter-group">
        <label><%= l(:field_status) %></label>
        <%= select_tag :status, options_for_select([['', ''], [l(:status_active), 'active'], [l(:status_inactive), 'inactive']], @status_filter) %>
      </div>

      <div class="psc-filter-actions">
        <%= submit_tag l(:button_apply), name: nil, class: 'psc-btn psc-btn-primary' %>
        <%= link_to l(:button_clear), project_psc_control_points_path(@project), class: 'psc-btn psc-btn-secondary' %>
      </div>
    </div>
  <% end %>
</div>

<% if @control_points.any? %>
  <div class="psc-section">
    <table class="psc-table">
      <thead>
        <tr>
          <%= sort_header_tag('control_id', caption: l(:field_control_id)) %>
          <%= sort_header_tag('name', caption: l(:field_name)) %>
          <th><%= l(:field_owner) %></th>
          <%= sort_header_tag('frequency', caption: l(:field_frequency)) %>
          <th><%= l(:field_assigned_to) %></th>
          <%= sort_header_tag('active', caption: l(:field_status)) %>
          <th><%= l(:label_actions) %></th>
        </tr>
      </thead>
      <tbody>
        <% @control_points.each do |cp| %>
          <tr class="<%= 'inactive' unless cp.active %>">
            <td>
              <span class="psc-control-id">
                <%= link_to cp.full_control_id, project_psc_control_point_path(@project, cp) %>
              </span>
            </td>
            <td>
              <%= link_to cp.name, project_psc_control_point_path(@project, cp), class: 'psc-link-primary' %>
              <% if cp.description.present? %>
                <div class="psc-description"><%= truncate(cp.description, length: 60) %></div>
              <% end %>
            </td>
            <td><%= cp.owner&.name || '-' %></td>
            <td>
              <span class="psc-frequency-badge psc-frequency-<%= cp.frequency %>"><%= cp.frequency_label %></span>
            </td>
            <td><%= cp.assigned_to&.name || '-' %></td>
            <td>
              <% if cp.active %>
                <span class="psc-badge psc-badge-success"><%= l(:status_active) %></span>
              <% else %>
                <span class="psc-badge psc-badge-secondary"><%= l(:status_inactive) %></span>
              <% end %>
            </td>
            <td class="psc-actions">
              <%= link_to l(:button_edit), edit_project_psc_control_point_path(@project, cp), class: 'icon icon-edit' %>
              <%= link_to l(:button_delete), project_psc_control_point_path(@project, cp),
                          method: :delete,
                          data: { confirm: l(:text_are_you_sure) },
                          class: 'icon icon-del' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="psc-pagination">
      <%= pagination_links_full @control_point_pages, @control_point_count %>
    </div>
  </div>
<% else %>
  <div class="psc-empty-state">
    <div class="psc-empty-icon">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
      </svg>
    </div>
    <p><%= l(:label_no_data) %></p>
    <%= link_to l(:label_psc_control_point_new), new_project_psc_control_point_path(@project), class: 'psc-btn psc-btn-primary' %>
  </div>
<% end %>
