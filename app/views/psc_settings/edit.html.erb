<%= title l(:label_settings) %>

<h2><%= l(:label_periodic_security_control) %> - <%= l(:label_settings) %></h2>

<%= form_tag(project_psc_settings_path(@project), method: :patch) do %>
  <div class="box tabular">
    <h3><%= l(:label_psc_general_settings) %></h3>

    <p>
      <label><%= l(:setting_psc_advance_days) %></label>
      <%= text_field_tag 'psc_setting[advance_days]', @settings.advance_days, size: 5 %>
      <em class="info"><%= l(:text_psc_advance_days_help) %></em>
    </p>

    <p>
      <label><%= l(:setting_psc_enable_auto_generation) %></label>
      <%= check_box_tag 'psc_setting[enable_auto_generation]', '1', @settings.enable_auto_generation %>
      <%= hidden_field_tag 'psc_setting[enable_auto_generation]', '0', id: nil %>
      <em class="info"><%= l(:text_psc_enable_auto_generation_help) %></em>
    </p>

    <h3><%= l(:label_psc_issue_templates) %></h3>

    <p>
      <label><%= l(:field_tracker) %></label>
      <%= select_tag 'psc_setting[default_tracker_id]',
                     options_from_collection_for_select(@trackers, :id, :name, @settings.default_tracker_id),
                     include_blank: true %>
      <em class="info"><%= l(:text_psc_tracker_help) %></em>
    </p>

    <p>
      <label><%= l(:field_priority) %></label>
      <%= select_tag 'psc_setting[default_priority_id]',
                     options_from_collection_for_select(@priorities, :id, :name, @settings.default_priority_id),
                     include_blank: true %>
    </p>

    <p>
      <label><%= l(:field_status) %></label>
      <%= select_tag 'psc_setting[default_status_id]',
                     options_from_collection_for_select(@statuses, :id, :name, @settings.default_status_id),
                     include_blank: true %>
      <em class="info"><%= l(:text_psc_default_status_help) %></em>
    </p>

    <p>
      <label><%= l(:setting_psc_issue_subject_template) %></label>
      <%= text_field_tag 'psc_setting[issue_subject_template]', @settings.issue_subject_template, size: 60 %>
    </p>

    <p>
      <label><%= l(:setting_psc_issue_description_template) %></label>
      <%= text_area_tag 'psc_setting[issue_description_template]', @settings.issue_description_template, rows: 10, cols: 60 %>
    </p>

    <fieldset class="collapsible collapsed">
      <legend onclick="toggleFieldset(this);"><%= l(:label_psc_available_variables) %></legend>
      <div style="display: none;">
        <ul>
          <li><code>{{control_id}}</code> - <%= l(:text_psc_var_control_id) %></li>
          <li><code>{{control_name}}</code> - <%= l(:text_psc_var_control_name) %></li>
          <li><code>{{category}}</code> - <%= l(:text_psc_var_category) %></li>
          <li><code>{{period}}</code> - <%= l(:text_psc_var_period) %></li>
          <li><code>{{year}}</code> - <%= l(:text_psc_var_year) %></li>
          <li><code>{{frequency}}</code> - <%= l(:text_psc_var_frequency) %></li>
          <li><code>{{scheduled_date}}</code> - <%= l(:text_psc_var_scheduled_date) %></li>
          <li><code>{{due_date}}</code> - <%= l(:text_psc_var_due_date) %></li>
        </ul>
      </div>
    </fieldset>

    <h3><%= l(:label_psc_schedule_configuration) %></h3>

    <p>
      <label><%= l(:setting_psc_weekly_start_day) %></label>
      <%= select_tag 'psc_setting[weekly_start_day]',
                     options_for_select([
                       [l(:day_name_monday), 1],
                       [l(:day_name_tuesday), 2],
                       [l(:day_name_wednesday), 3],
                       [l(:day_name_thursday), 4],
                       [l(:day_name_friday), 5]
                     ], @settings.weekly_start_day) %>
      <em class="info"><%= l(:text_psc_weekly_start_day_help) %></em>
    </p>

    <p>
      <label><%= l(:setting_psc_monthly_start_day) %></label>
      <%= select_tag 'psc_setting[monthly_start_day]',
                     options_for_select((1..28).map { |d| [d, d] }, @settings.monthly_start_day) %>
      <em class="info"><%= l(:text_psc_monthly_start_day_help) %></em>
    </p>

    <p>
      <label><%= l(:setting_psc_quarterly_start_month) %></label>
      <%= select_tag 'psc_setting[quarterly_start_month]',
                     options_for_select((1..12).map { |m| [l("date.month_names")[m], m] }, @settings.quarterly_start_month) %>
      <em class="info"><%= l(:text_psc_quarterly_start_month_help) %></em>
    </p>

    <p>
      <label><%= l(:setting_psc_six_monthly_start_month) %></label>
      <%= select_tag 'psc_setting[six_monthly_start_month]',
                     options_for_select((1..12).map { |m| [l("date.month_names")[m], m] }, @settings.six_monthly_start_month) %>
      <em class="info"><%= l(:text_psc_six_monthly_start_month_help) %></em>
    </p>

    <p>
      <label><%= l(:setting_psc_yearly_start_month) %></label>
      <%= select_tag 'psc_setting[yearly_start_month]',
                     options_for_select((1..12).map { |m| [l("date.month_names")[m], m] }, @settings.yearly_start_month) %>
      <em class="info"><%= l(:text_psc_yearly_start_month_help) %></em>
    </p>
  </div>

  <p>
    <%= submit_tag l(:button_save) %>
    <%= link_to l(:button_cancel), project_psc_control_points_path(@project) %>
  </p>
<% end %>
