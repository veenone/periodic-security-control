<%= title l(:label_psc_categories) %>

<div class="contextual">
  <%= link_to l(:label_psc_category_new), new_project_psc_category_path(@project), class: 'icon icon-add' %>
  <%= link_to l(:label_psc_export), export_project_psc_categories_path(@project, format: :csv), class: 'icon icon-download' %>
</div>

<h2><%= l(:label_psc_categories) %></h2>

<%= form_tag(import_project_psc_categories_path(@project), multipart: true, class: 'psc-import-form') do %>
  <fieldset class="collapsible collapsed">
    <legend onclick="toggleFieldset(this);"><%= l(:label_psc_import) %></legend>
    <div style="display: none;">
      <p>
        <%= file_field_tag 'file', accept: '.csv' %>
        <%= submit_tag l(:button_import), class: 'small' %>
      </p>
      <p class="info"><%= l(:text_psc_import_help) %></p>
    </div>
  </fieldset>
<% end %>

<% if @categories.any? %>
  <table class="list psc-categories-table">
    <thead>
      <tr>
        <%= sort_header_tag('position', caption: '#', default_order: 'asc') %>
        <%= sort_header_tag('code', caption: l(:field_code)) %>
        <%= sort_header_tag('name', caption: l(:field_name)) %>
        <th><%= l(:label_psc_control_points_count) %></th>
        <th><%= l(:field_active) %></th>
        <th><%= l(:label_actions) %></th>
      </tr>
    </thead>
    <tbody>
      <% @categories.each do |category| %>
        <tr class="<%= cycle('odd', 'even') %> <%= 'inactive' unless category.active %>">
          <td class="position"><%= category.position %></td>
          <td class="code"><strong><%= category.code %></strong></td>
          <td class="name">
            <%= link_to category.name, project_psc_category_path(@project, category) %>
            <% if category.description.present? %>
              <br><span class="description"><%= truncate(category.description, length: 100) %></span>
            <% end %>
          </td>
          <td class="control-points-count">
            <%= link_to category.control_points.active.count, project_psc_category_path(@project, category) %>
          </td>
          <td class="active">
            <%= checked_image(category.active) %>
          </td>
          <td class="buttons">
            <%= link_to l(:button_edit), edit_project_psc_category_path(@project, category), class: 'icon icon-edit' %>
            <%= link_to l(:button_delete), project_psc_category_path(@project, category),
                        method: :delete,
                        data: { confirm: l(:text_are_you_sure) },
                        class: 'icon icon-del' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="nodata"><%= l(:label_no_data) %></p>
<% end %>
