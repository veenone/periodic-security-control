<%= title l(:label_psc_categories) %>

<div class="contextual">
  <%= link_to l(:label_psc_category_new), new_project_psc_category_path(@project), class: 'icon icon-add' %>
  <%= link_to l(:label_psc_export), export_project_psc_categories_path(@project, format: :csv), class: 'icon icon-download' %>
</div>

<div class="psc-section">
  <%= form_tag(import_project_psc_categories_path(@project), multipart: true, class: 'psc-import-form') do %>
    <fieldset class="collapsible collapsed">
      <legend onclick="toggleFieldset(this);"><%= l(:label_psc_import) %></legend>
      <div style="display: none;">
        <div class="psc-import-content">
          <%= file_field_tag 'file', accept: '.csv', class: 'psc-file-input' %>
          <%= submit_tag l(:button_import), class: 'psc-btn psc-btn-primary' %>
        </div>
        <p class="psc-help-text"><%= l(:text_psc_import_help) %></p>
      </div>
    </fieldset>
  <% end %>
</div>

<% if @categories.any? %>
  <div class="psc-section">
    <table class="psc-table">
      <thead>
        <tr>
          <%= sort_header_tag('position', caption: '#', default_order: 'asc') %>
          <%= sort_header_tag('code', caption: l(:field_code)) %>
          <%= sort_header_tag('name', caption: l(:field_name)) %>
          <th class="text-center"><%= l(:label_psc_control_points_count) %></th>
          <th class="text-center"><%= l(:field_active) %></th>
          <th><%= l(:label_actions) %></th>
        </tr>
      </thead>
      <tbody>
        <% @categories.each do |category| %>
          <tr class="<%= 'inactive' unless category.active %>">
            <td class="text-center"><%= category.position %></td>
            <td>
              <span class="psc-code-badge"><%= category.code %></span>
            </td>
            <td>
              <%= link_to category.name, project_psc_category_path(@project, category), class: 'psc-link-primary' %>
              <% if category.description.present? %>
                <div class="psc-description"><%= truncate(category.description, length: 100) %></div>
              <% end %>
            </td>
            <td class="text-center">
              <span class="psc-count-badge">
                <%= link_to category.control_points.active.count, project_psc_category_path(@project, category) %>
              </span>
            </td>
            <td class="text-center">
              <% if category.active %>
                <span class="psc-badge psc-badge-success"><%= l(:status_active) %></span>
              <% else %>
                <span class="psc-badge psc-badge-secondary"><%= l(:status_inactive) %></span>
              <% end %>
            </td>
            <td class="psc-actions">
              <%= link_to l(:button_edit), edit_project_psc_category_path(@project, category), class: 'icon icon-edit' %>
              <%= link_to l(:button_delete), project_psc_category_path(@project, category),
                          method: :delete,
                          data: { confirm: l(:text_are_you_sure) },
                          class: 'icon icon-del' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="psc-empty-state">
    <div class="psc-empty-icon">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
      </svg>
    </div>
    <p><%= l(:label_no_data) %></p>
    <%= link_to l(:label_psc_category_new), new_project_psc_category_path(@project), class: 'psc-btn psc-btn-primary' %>
  </div>
<% end %>
