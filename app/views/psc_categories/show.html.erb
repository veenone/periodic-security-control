<%= title "#{@category.code} - #{@category.name}" %>

<div class="contextual">
  <%= link_to l(:button_edit), edit_psc_category_path(@category), class: 'icon icon-edit' %>
  <%= link_to l(:label_psc_control_point_new), new_psc_category_psc_control_point_path(@category), class: 'icon icon-add' %>
  <%= form_tag(bulk_generate_schedules_psc_category_psc_control_points_path(@category), method: :post, style: 'display: inline;') do %>
    <%= hidden_field_tag :year, Date.current.year %>
    <%= submit_tag l(:label_psc_generate_schedules, year: Date.current.year), class: 'icon icon-reload', data: { confirm: l(:text_psc_generate_schedules_confirm) } %>
  <% end %>
</div>

<h2><%= @category.code %> - <%= @category.name %></h2>

<div class="splitcontentleft">
  <fieldset class="box">
    <legend><%= l(:label_information) %></legend>
    <p>
      <strong><%= l(:field_code) %>:</strong> <%= @category.code %><br>
      <strong><%= l(:field_name) %>:</strong> <%= @category.name %><br>
      <strong><%= l(:field_active) %>:</strong> <%= checked_image(@category.active) %><br>
      <% if @category.description.present? %>
        <strong><%= l(:field_description) %>:</strong><br>
        <%= simple_format(@category.description) %>
      <% end %>
    </p>
  </fieldset>
</div>

<div class="splitcontentright">
  <fieldset class="box">
    <legend><%= l(:label_statistics) %></legend>
    <p>
      <strong><%= l(:label_psc_control_points_count) %>:</strong> <%= @category.control_points.active.count %><br>
      <strong><%= l(:label_psc_total_schedules) %> (<%= Date.current.year %>):</strong> <%= @category.total_schedules_count %><br>
      <strong><%= l(:label_psc_completed) %>:</strong> <%= @category.completed_schedules_count %><br>
      <strong><%= l(:label_psc_completion_rate) %>:</strong> <%= @category.completion_rate %>%
    </p>
  </fieldset>
</div>

<div style="clear: both;"></div>

<h3><%= l(:label_psc_control_points) %></h3>

<% if @control_points.any? %>
  <table class="list psc-control-points-table">
    <thead>
      <tr>
        <th><%= l(:field_control_id) %></th>
        <th><%= l(:field_name) %></th>
        <th><%= l(:field_frequency) %></th>
        <th><%= l(:field_tracker) %></th>
        <th><%= l(:field_assigned_to) %></th>
        <th><%= l(:field_active) %></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @control_points.each do |cp| %>
        <tr class="<%= cycle('odd', 'even') %> <%= 'inactive' unless cp.active %>">
          <td class="control-id"><strong><%= cp.full_control_id %></strong></td>
          <td class="name">
            <%= link_to cp.name, psc_category_psc_control_point_path(@category, cp) %>
          </td>
          <td class="frequency"><%= cp.frequency_label %></td>
          <td class="tracker"><%= cp.tracker&.name || '-' %></td>
          <td class="assigned-to"><%= cp.assigned_to&.name || '-' %></td>
          <td class="active"><%= checked_image(cp.active) %></td>
          <td class="buttons">
            <%= link_to l(:button_edit), edit_psc_category_psc_control_point_path(@category, cp), class: 'icon icon-edit' %>
            <%= link_to l(:button_delete), psc_category_psc_control_point_path(@category, cp),
                        method: :delete,
                        data: { confirm: l(:text_are_you_sure) },
                        class: 'icon icon-del' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="nodata"><%= l(:label_no_data) %></p>
<% end %>

<p>
  <%= link_to l(:button_back), psc_categories_path %>
</p>
